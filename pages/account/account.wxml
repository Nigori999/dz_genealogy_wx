<!-- 账户与安全设置页面 -->
<view class="container">
  <view wx:if="{{isLoading}}" class="loading-container">
    <loading type="spinner" text="加载中..."></loading>
  </view>
  <block wx:else>
    <!-- 账户安全 -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">账户安全</text>
      </view>
      <view class="section-content">
        <!-- 微信信息 -->
        <view class="setting-item">
          <view class="item-left">
            <text class="item-icon iconfont icon-wechat"></text>
            <text class="item-name">微信账号</text>
          </view>
          <view class="item-right">
            <text class="item-value">已关联</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 账户信息 -->
    <view class="section">
      <view class="section-header" bindtap="toggleUserInfoCard">
        <text class="section-title">账户信息</text>
        <view class="section-toggle">
          <text class="toggle-text">{{isUserInfoExpanded ? '收起' : '展开'}}</text>
          <text class="iconfont {{isUserInfoExpanded ? 'icon-arrow-up' : 'icon-arrow-down'}}"></text>
        </view>
      </view>
      <view class="section-content" wx:if="{{isUserInfoExpanded}}">
        <!-- 昵称 -->
        <view class="setting-item" bindtap="editNickname">
          <view class="item-left">
            <text class="item-name">昵称</text>
          </view>
          <view class="item-right">
            <text class="item-value">{{userInfo.nickname || '未设置'}}</text>
            <text class="iconfont icon-arrow-right"></text>
          </view>
        </view>
        
        <!-- 姓名 -->
        <view class="setting-item" bindtap="verifyRealName">
          <view class="item-left">
            <text class="item-name">姓名</text>
          </view>
          <view class="item-right">
            <text class="item-value">{{userInfo.realName || '未认证'}}</text>
            <text class="iconfont icon-arrow-right"></text>
          </view>
        </view>
        
        <!-- 性别 -->
        <view class="setting-item" bindtap="editGender">
          <view class="item-left">
            <text class="item-name">性别</text>
          </view>
          <view class="item-right">
            <text class="item-value">{{userInfo.genderText || '未设置'}}</text>
            <text class="iconfont icon-arrow-right"></text>
          </view>
        </view>
        
        <!-- 手机绑定 -->
        <view class="setting-item" bindtap="bindPhoneNumber">
          <view class="item-left">
            <text class="item-name">手机号</text>
          </view>
          <view class="item-right">
            <text class="item-value">{{hasBoundPhone ? phoneNumberHidden : '未绑定'}}</text>
            <text class="iconfont icon-arrow-right"></text>
          </view>
        </view>
        
        <!-- 居住地 -->
        <view class="setting-item">
          <view class="item-left">
            <text class="item-name">居住地</text>
          </view>
          <view class="item-right">
            <picker 
              mode="region" 
              bindchange="bindRegionChange"
              value="{{region}}"
              custom-item="{{customItem}}">
              <view class="picker-view">
                <text class="item-value">{{userInfo.residence || '未设置'}}</text>
                <text class="iconfont icon-arrow-right"></text>
              </view>
            </picker>
          </view>
        </view>
        
        <!-- 用户ID -->
        <view class="setting-item">
          <view class="item-left">
            <text class="item-name">用户ID</text>
          </view>
          <view class="item-right">
            <text class="item-value">{{userInfo.uid || '-'}}</text>
            <text class="item-copy" catchtap="copyUserId">复制</text>
          </view>
        </view>
        
        <!-- 注册时间 -->
        <view class="setting-item">
          <view class="item-left">
            <text class="item-name">注册时间</text>
          </view>
          <view class="item-right">
            <text class="item-value">{{userInfo.createTime || '-'}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 信息可见性 -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">信息可见性</text>
      </view>
      <view class="section-content">
        <view class="visibility-desc">控制个人信息在族谱节点中的显示</view>
        
        <!-- 年龄可见性 -->
        <view class="setting-item">
          <view class="item-left">
            <text class="item-name">年龄</text>
            <text class="item-desc">控制是否在族谱节点详细信息中展示</text>
          </view>
          <view class="item-right">
            <switch 
              class="mini-switch" 
              checked="{{privacySettings.showAge}}" 
              color="#D84315" 
              bindchange="togglePrivacySetting"
              data-type="showAge"
            />
          </view>
        </view>
        
        <!-- 居住地可见性 -->
        <view class="setting-item">
          <view class="item-left">
            <text class="item-name">居住地</text>
            <text class="item-desc">控制是否在族谱节点详细信息中展示</text>
          </view>
          <view class="item-right">
            <switch 
              class="mini-switch" 
              checked="{{privacySettings.showResidence}}" 
              color="#D84315" 
              bindchange="togglePrivacySetting"
              data-type="showResidence"
            />
          </view>
        </view>
        
        <!-- 职业可见性 -->
        <view class="setting-item">
          <view class="item-left">
            <text class="item-name">职业</text>
            <text class="item-desc">控制是否在族谱节点详细信息中展示</text>
          </view>
          <view class="item-right">
            <switch 
              class="mini-switch" 
              checked="{{privacySettings.showOccupation}}" 
              color="#D84315" 
              bindchange="togglePrivacySetting"
              data-type="showOccupation"
            />
          </view>
        </view>
      </view>
    </view>
    
    <!-- 账号注销 -->
    <view class="delete-section">
      <button class="delete-account-btn" type="default" bindtap="deleteAccount">注销账号</button>
      <view class="delete-hint">
        <text>注销后，账号关联的所有数据将被永久删除且无法恢复</text>
      </view>
    </view>
  </block>
</view> 