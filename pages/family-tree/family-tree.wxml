<!-- 家族树页面 -->
<view class="container">
  <!-- 族谱信息 -->
  <view class="genealogy-info">
    <view class="genealogy-name">{{currentGenealogy.name}}</view>
    <view class="genealogy-meta">
      <view class="meta-item">
        <text class="meta-label">成员</text>
        <text class="meta-value">{{allMembers.length || 0}}</text>
      </view>
      <view class="meta-item">
        <text class="meta-label">世代</text>
        <text class="meta-value">{{maxGeneration || 0}}</text>
      </view>
    </view>
  </view>

  <!-- 控制面板 -->
  <view class="tree-controls">
    <view class="control-group">
      <view 
        class="control-btn {{viewMode === 'tree' ? 'active' : ''}}" 
        bindtap="switchViewMode" 
        data-mode="tree"
      >
        <text class="iconfont icon-tree"></text>
        <text>树图</text>
      </view>
      <view 
        class="control-btn {{viewMode === 'list' ? 'active' : ''}}" 
        bindtap="switchViewMode" 
        data-mode="list"
      >
        <text class="iconfont icon-list"></text>
        <text>列表</text>
      </view>
    </view>
    <view class="control-group">
      <view 
        class="control-btn direction-btn {{direction === 'vertical' ? 'active' : ''}}" 
        bindtap="switchDirection" 
        data-direction="vertical"
      >
        <text class="iconfont icon-vertical"></text>
      </view>
      <view 
        class="control-btn direction-btn {{direction === 'horizontal' ? 'active' : ''}}" 
        bindtap="switchDirection" 
        data-direction="horizontal"
      >
        <text class="iconfont icon-horizontal"></text>
      </view>
    </view>
  </view>

  <!-- 世代筛选器 -->
  <view class="generation-filter" wx:if="{{viewMode === 'list'}}">
    <scroll-view scroll-x class="filter-scroll">
      <view class="filter-options">
        <view 
          class="filter-option {{selectedGeneration === 0 ? 'active' : ''}}" 
          bindtap="selectGeneration" 
          data-generation="0"
        >
          全部
        </view>
        <view 
          wx:for="{{generations}}" 
          wx:key="index" 
          class="filter-option {{selectedGeneration === item ? 'active' : ''}}" 
          bindtap="selectGeneration" 
          data-generation="{{item}}"
        >
          第{{item}}代
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 树图视图 -->
  <scroll-view 
    wx:if="{{viewMode === 'tree'}}" 
    class="tree-view {{direction}}"
    scroll-x="{{direction === 'horizontal'}}"
    scroll-y="{{direction === 'vertical'}}"
    style="height: {{treeViewHeight}}px;"
  >
    <view 
      class="tree-container {{direction}}"
      style="width: {{treeWidth}}px; height: {{treeHeight}}px;"
    >
      <view wx:if="{{isLoading}}" class="tree-loading">
        <loading type="spinner" text="构建家族树中..."></loading>
      </view>
      <block wx:elif="{{familyTree}}">
        <!-- 树节点组件将在这里渲染 -->
        <tree-node 
          wx:for="{{treeNodes}}" 
          wx:key="id"
          node="{{item}}"
          direction="{{direction}}"
          bind:select="onNodeSelect"
        ></tree-node>
        
        <!-- 树连接线组件将在这里渲染 -->
        <tree-connector 
          wx:for="{{treeConnectors}}" 
          wx:key="id"
          connector="{{item}}"
          direction="{{direction}}"
        ></tree-connector>
      </block>
      <view wx:else class="tree-empty">
        <image class="empty-image" src="/assets/images/empty_tree.png" mode="aspectFit"></image>
        <view class="empty-text">暂无家族成员，开始添加第一位成员吧</view>
        <button class="btn-primary" bindtap="navigateToAddMember">添加成员</button>
      </view>
    </view>
  </scroll-view>

  <!-- 列表视图 -->
  <scroll-view 
    wx:if="{{viewMode === 'list'}}" 
    class="list-view"
    scroll-y
    style="height: {{listViewHeight}}px;"
  >
    <view wx:if="{{isLoading}}" class="list-loading">
      <loading type="spinner" text="加载中..."></loading>
    </view>
    <block wx:elif="{{filteredMembers.length > 0}}">
      <view class="member-list">
        <member-card 
          wx:for="{{filteredMembers}}" 
          wx:key="id"
          member="{{item}}"
          is-root-member="{{currentGenealogy.rootMemberId === item.id}}"
          is-latest-gen="{{item.generation === maxGeneration}}"
          bind:detail="onMemberDetail"
          bind:edit="onMemberEdit"
        ></member-card>
      </view>
    </block>
    <view wx:else class="list-empty">
      <image class="empty-image" src="/assets/images/empty_members.png" mode="aspectFit"></image>
      <view class="empty-text">暂无家族成员，开始添加第一位成员吧</view>
      <button class="btn-primary" bindtap="navigateToAddMember">添加成员</button>
    </view>
  </scroll-view>

  <!-- 悬浮添加按钮 -->
  <view class="fab" bindtap="navigateToAddMember" wx:if="{{currentGenealogy && allMembers.length > 0}}">
    <text class="iconfont icon-add"></text>
  </view>
</view>