<!-- 邀请页面 -->
<view class="container">
  <view class="page-header">
    <view class="header-title">邀请成员</view>
  </view>

  <view class="content-panel">
    <!-- 族谱基本信息 -->
    <view class="genealogy-info card">
      <view class="genealogy-name">{{genealogy.name}}</view>
      <view class="genealogy-desc">邀请亲人一起记录家族历史</view>
    </view>

    <!-- 创建邀请 -->
    <view class="invite-action card">
      <view class="section-title">创建邀请</view>
      <view class="invite-desc">
        生成邀请码，邀请家族成员加入族谱。邀请码有效期为7天，最多可使用10次。
      </view>
      <view class="invite-buttons">
        <button class="btn-generate btn-full-width" bindtap="generateInviteCode">
          <text class="iconfont icon-invite"></text>
          <text>生成邀请码</text>
        </button>
      </view>
    </view>

    <!-- 邀请记录 -->
    <view class="invite-records card">
      <view class="section-title">邀请记录</view>
      <view wx:if="{{inviteRecords.length === 0}}" class="empty-records">
        <image class="empty-icon" src="/assets/images/empty_records.png" mode="aspectFit"></image>
        <text class="empty-text">暂无邀请记录</text>
      </view>
      <view wx:else class="records-list">
        <view class="record-item" wx:for="{{inviteRecords}}" wx:key="id">
          <view class="record-top">
            <view class="record-code">
              <text class="code-label">邀请码:</text>
              <text class="code-value">{{item.code}}</text>
            </view>
            <view class="record-date">{{item.createdAt}}</view>
          </view>
          <view class="record-bottom">
            <view class="record-status {{item.expired ? 'expired' : ''}}">
              {{item.expired ? '已过期' : '有效'}}
            </view>
            <view class="record-actions">
              <view class="action-btn" catchtap="copyHistoryCode" data-code="{{item.code}}">
                <text class="iconfont icon-copy"></text>
                <text>复制</text>
              </view>
              <button 
                class="action-btn share-btn" 
                open-type="share" 
                data-code="{{item.code}}">
                <text class="iconfont icon-share"></text>
                <text>分享</text>
              </button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 邀请说明 -->
    <view class="invite-tips card">
      <view class="tip-title">邀请说明</view>
      <view class="tip-content">
        <text>1. 被邀请人需要先安装"云族谱"小程序。</text>
        <text>2. 您可以通过以下方式分享邀请：</text>
        <text>  - 复制邀请码，发送给对方</text>
        <text>  - 复制邀请链接，发送给对方</text>
        <text>  - 生成二维码，让对方扫码加入</text>
        <text>  - 直接转发小程序分享卡片</text>
        <text>3. 邀请码创建后7天内有效。</text>
      </view>
    </view>
  </view>

  <!-- 成功生成邀请码对话框 -->
  <view class="dialog-mask" wx:if="{{showSuccessDialog}}" bindtap="closeSuccessDialog"></view>
  <view class="dialog-container" wx:if="{{showSuccessDialog}}">
    <view class="dialog-content">
      <view class="dialog-title">邀请码创建成功</view>
      <view class="dialog-code">
        <text class="code-value">{{inviteCode}}</text>
        <view class="copy-btn" bindtap="copyInviteCode">复制</view>
      </view>
      <view class="dialog-desc">请将此邀请码分享给您想邀请的亲人</view>
      <view class="dialog-actions">
        <view class="action-item" bindtap="copyInviteURL">
          <text class="iconfont icon-link"></text>
          <text>复制链接</text>
        </view>
        <view class="action-item" bindtap="showQrCode">
          <text class="iconfont icon-qrcode"></text>
          <text>显示二维码</text>
        </view>
        <button class="action-item share-btn" open-type="share">
          <text class="iconfont icon-wechat"></text>
          <text>分享到微信</text>
        </button>
      </view>
      <view class="dialog-close" bindtap="closeSuccessDialog">关闭</view>
    </view>
  </view>

  <!-- 二维码弹窗 -->
  <view class="qrcode-mask" wx:if="{{showQrCode}}" bindtap="closeQrCode"></view>
  <view class="qrcode-container" wx:if="{{showQrCode}}">
    <view class="qrcode-content">
      <view class="qrcode-title">邀请二维码</view>
      <view class="qrcode-image">
        <image src="{{inviteQrCode}}" mode="aspectFit"></image>
      </view>
      <view class="qrcode-tip">扫描上方二维码加入族谱</view>
      <view class="qrcode-actions">
        <view class="qrcode-action" bindtap="saveQrCode">
          <text class="iconfont icon-save"></text>
          <text>保存到相册</text>
        </view>
      </view>
      <view class="qrcode-close" bindtap="closeQrCode">关闭</view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{isLoading}}" class="loading-container">
    <view class="loading-mask"></view>
    <view class="loading-content">
      <view class="spinner"></view>
      <view class="loading-text">处理中...</view>
    </view>
  </view>
</view>